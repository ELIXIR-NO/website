---
import Page from "../../layouts/page.astro";
import { getCollection } from "astro:content";
import CardV2 from "../../components/card.v2";
import { idToSlug, resolveContentAsset } from "../../lib/utils";

// Function to normalize the date
function parseDate(dateString: string): number {
    // Try to create a date using the Date constructor
    const parsedDate = new Date(Date.parse(dateString));
    // If the date is invalid, return a default timestamp (0 represents the epoch)
    if (isNaN(parsedDate.getTime())) {
        return new Date(0).getTime(); // Return the default date's timestamp
    }
    return parsedDate.getTime(); // Return the timestamp of the parsed date
}

const events = await getCollection("events");
events.sort((a, b) => parseDate(b.data.date) - parseDate(a.data.date));
---

<Page title="Events" variant="full">
    <ol
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-y-12 gap-x-12"
    >
        {
            events.map((entry) => {
                return (
                    <CardV2
                        link={`/events/${idToSlug(entry.id)}`}
                        title={entry.data.title}
                        summary={entry.data.summary}
                        cover={entry.data?.cover?.source
                            ? resolveContentAsset(`${entry.collection}/${entry.id}`, entry.data.cover.source)
                            : undefined}
                        date={entry.data.date}
                    />
                );
            })
        }
    </ol>
</Page>
